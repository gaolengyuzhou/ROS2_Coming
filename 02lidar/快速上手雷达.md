> ğŸ®ğŸ®ğŸ®ç›´æ¥ä½¿ç”¨ Docker æ¥è¿è¡Œäº†é›·è¾¾å’Œç›´æ¥å»ºå›¾

1. å°†é…å¥—çš„é›·è¾¾è½¬æ¥æ¿æ¨¡å¼è°ƒæ•´åˆ°UARTæ¨¡å¼ï¼Œæ‹”æ‰ENè·³çº¿å¸½ï¼ˆå¯ä»¥å…³é—­ESP8266,èŠ‚çœèƒ½æºï¼‰ï¼Œ æ‰¾ä¸€æ ¹USBçº¿ï¼Œå°† é›·è¾¾æ¿æ¥å…¥åˆ°ä½ è¦é©±åŠ¨çš„ç”µè„‘æˆ–è€…å„ç§PIä¸Šã€‚
```
è¿è¡ŒDockerç‰ˆæœ¬é…ç½®åŠ©æ‰‹

xhost + && sudo docker run -it --rm --privileged -v /dev:/dev -v /tmp/.X11-unix:/tmp/.X11-unix -e DISPLAY=unix$DISPLAY fishros2/fishbot_tool:v1.1.1.alpha
```
2. åˆ›å»ºfishbot_wså·¥ä½œç©ºé—´ï¼Œä¸‹è½½æºç åˆ°srcç›®å½•ï¼š
```
mkdir -p ~/fishbot_ws/src
cd ~/fishbot_ws/src
git clone http://github.fishros.org/https://github.com/fishros/ydlidar_ros2 -b  v1.0.0/fishbot 
```
1. è¿›å…¥åˆ°æºç ï¼Œä¿®æ”¹ä¸²å£ç¼–å·ydlidar_ros2/params/ydlidar.yamlï¼Œä¸€èˆ¬æ˜¯/dev/ttyUSB0
â€µâ€µâ€µ
ydlidar_node:
  ros__parameters:
    port: /dev/ttyUSB0
    frame_id: laser_frame
    ignore_array: ""
â€µâ€µâ€µ
1. æ¥ç€ç¼–è¯‘ ï¼š
â€µâ€µâ€µ
cd ydlidar_ros2
colcon build
â€µâ€µâ€µ
1. æ¥ç€ä¿®æ”¹ä¸²å£æƒé™ï¼Œç„¶åè¿è¡Œé©±åŠ¨
```
sudo chmod 666 /dev/ttyUSB0
source install/setup.bash
ros2 launch ydlidar ydlidar_launch.py
```
1. æœ€åä½¿ç”¨ros2 topic list å°±å¯ä»¥çœ‹åˆ°è¯é¢˜listäº†ï¼Œscanå°±æ˜¯é›·è¾¾è¯é¢˜
```
ros2 topic list
---
/parameter_events
/rosout
/scan
/tf_static
/ydlidar_node/transition_even
```

# ğŸ·ğŸ·ğŸ·æ— çº¿é©±åŠ¨
**é›·è¾¾æ¿çš„ä¸»è¦ä½œç”¨æ˜¯å°†é›·è¾¾ æ•°æ®ç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿçš„ä¸²å£ é›·è¾¾æ¿çƒ§å½•å›ºä»¶**

> https://fishros.org.cn/forum/topic/940/fishbot%E6%95%99%E7%A8%8B-9-0-5-%E9%9B%B7%E8%BE%BE%E5%9B%BA%E4%BB%B6%E7%83%A7%E5%BD%95%E5%8F%8A%E9%85%8D%E7%BD%AE

1. çƒ§å½•å®Œæˆå›ºä»¶åï¼Œæ¥ç€æˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨æœåŠ¡è®©é›·è¾¾æ¿è¿æ¥ä¸Šæ¥ï¼Œåœ¨ç”µè„‘ä¸Šç›´æ¥è¿è¡Œä¸‹é¢è¿™æ®µPythonä»£ç ï¼Œå½“è¿æ¥å»ºç«‹åï¼Œå°±ä¼šç›´æ¥ç”Ÿæˆ ä¸€ä¸ªè™šæ‹Ÿä¸²å£
```python
#!/usr/bin/env python3

import subprocess
import os
import pty
import socket
import select
import argparse
import subprocess
import time

class LaserScanRos2():

    def __init__(self) -> None:
        self.laser_pro = None
    

class SocketServer():
    def __init__(self,lport=8889,uart_name="/tmp/fishbot_laser") -> None:
        self.lport = lport
        self.uart_name = uart_name
        self.laser_ros2 = LaserScanRos2()
        self.main()

    def main(self):
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        s.bind(('0.0.0.0', self.lport))
        s.listen(5)
        master, slave = pty.openpty()
        if os.path.exists(self.uart_name):
            os.remove(self.uart_name)
        os.symlink(os.ttyname(slave), self.uart_name)
        print(f"UART2SOCKET:{self.lport}->{self.uart_name}")
        mypoll = select.poll()
        mypoll.register(master, select.POLLIN)
        try:
            while True:
                print("Prepare to Accept connect!")
                client, client_address = s.accept()
                mypoll.register(client.fileno(), select.POLLIN)
                print(s.fileno(), client, master)
                print('PTY: Opened {} for {}:{}'.format(
                    os.ttyname(slave), '0.0.0.0', self.lport))
                is_connect = True
                try:
                    while is_connect:
                        fdlist = mypoll.poll(256)
                        for fd, event in fdlist:
                            data = os.read(fd, 256)
                            write_fd = client.fileno() if fd == master else master
                            if len(data) == 0:
                                is_connect = False
                                break
                            os.write(write_fd, data)
                            # print(fd, event, data)
                except ConnectionResetError:
                    is_connect = False
                    print("è¿œç¨‹è¢«è¿«æ–­å¼€é“¾æ¥")
                finally:
                    mypoll.unregister(client.fileno())
        finally:
            s.close()
            os.close(master)
            os.close(slave)
            os.remove(self.uart_name)

def main():
    SocketServer()


if __name__ == "__main__":
    main()
```
2. è¿æ¥æˆåŠŸåï¼Œä¼šç”Ÿæˆ/tmp/fishbot_laser è™šæ‹Ÿä¸²å£ï¼Œä¿®æ”¹é›·è¾¾é©±åŠ¨çš„ç«¯å£å·åˆ°è¿™ä¸ªè™šæ‹Ÿä¸²å£ï¼Œç¡®å®šé›·è¾¾è¿æ¥ä¸Šï¼Œç„¶åå¯åŠ¨é›·è¾¾é©±åŠ¨å°±å¯ä»¥äº†ã€‚
```
python3 test.py
```
